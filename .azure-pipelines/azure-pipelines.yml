# gildihub-ui ‚Äî dual-mode pool, Node 20, build-only (no deploy), publish artifact

trigger:
  branches: { include: [develop, main] }

pr:
  branches: { include: [develop, main] }

variables:
  - name: USE_HOSTED
    value: 'false'
  - name: SELF_HOSTED_POOL
    value: 'Default'
  - name: VM_IMAGE
    value: 'windows-latest'

pool:
  ${{ if eq(variables['USE_HOSTED'], 'true') }}:
    vmImage: ${{ variables.VM_IMAGE }}
  ${{ if ne(variables['USE_HOSTED'], 'true') }}:
    name: ${{ variables.SELF_HOSTED_POOL }}

stages:
  - stage: build
    displayName: Build
    jobs:
      - job: build
        displayName: Install & Build (Node 20)
        steps:
          - pwsh: 'Write-Host "ASSERT NEW YAML üçÄ $(Build.DefinitionName) @ $(Build.SourceVersion)"'
          - task: NodeTool@0
            displayName: Use Node.js 20.x
            inputs:
              versionSpec: '20.x'
              checkLatest: true
          - pwsh: |
              $v = (node -v) -replace '[vV]',''
              if ([version]$v -lt [version]'20.0.0') { throw "Node < 20 detected ($v)" }
              npm ci
              npm run build
            displayName: npm ci & build
          - task: ArchiveFiles@2
            inputs:
              rootFolderOrFile: '$(Build.SourcesDirectory)'
              includeRootFolder: false
              archiveType: zip
              archiveFile: '$(Build.ArtifactStagingDirectory)/ui-drop.zip'
              replaceExistingArchive: true
          - task: PublishBuildArtifacts@1
            inputs:
              PathtoPublish: '$(Build.ArtifactStagingDirectory)'
              ArtifactName: 'ui-drop'
              publishLocation: 'Container'
