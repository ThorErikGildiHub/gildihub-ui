# Azure Pipelines (dual-mode) â€” Hosted or Self-hosted (Windows)
trigger:
  - main

pr:
  - main

variables:
  NODE_VERSION: '20.x'
  USE_SELF_HOSTED: 'false'

jobs:
- job: hosted
  displayName: Build (Hosted)
  condition: ne(variables['USE_SELF_HOSTED'], 'true')
  pool:
    vmImage: 'windows-latest'
  steps:
  - task: NodeTool@0
    displayName: "Use Node $(NODE_VERSION)"
    inputs:
      versionSpec: '$(NODE_VERSION)'
  - powershell: |
      if (Test-Path package.json) {
        npm ci
        if ((Get-Content package.json -Raw | ConvertFrom-Json).scripts.build) { npm run build }
        else { Write-Host "No build script" }
      } else { Write-Host "No package.json" }
    displayName: "Install & Build"

- job: selfhosted
  displayName: Build (Self-hosted)
  condition: eq(variables['USE_SELF_HOSTED'], 'true')
  pool:
    name: Default
  steps:
  - task: NodeTool@0
    displayName: "Use Node $(NODE_VERSION)"
    inputs:
      versionSpec: '$(NODE_VERSION)'
  - powershell: |
      if (Test-Path package.json) {
        npm ci
        if ((Get-Content package.json -Raw | ConvertFrom-Json).scripts.build) { npm run build }
        else { Write-Host "No build script" }
      } else { Write-Host "No package.json" }
    displayName: "Install & Build"
